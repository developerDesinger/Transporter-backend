{
  "info": {
    "name": "Transporter Backend API",
    "description": "Complete API collection for Transport Management System including authentication, user management, and approval workflows",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "transporter-backend-2024"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string",
      "description": "Base URL for the API"
    },
    {
      "key": "token",
      "value": "",
      "type": "string",
      "description": "JWT authentication token (auto-saved after login)"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string",
      "description": "User ID (auto-saved after registration)"
    },
    {
      "key": "superAdminToken",
      "value": "",
      "type": "string",
      "description": "Super admin token for approval endpoints"
    },
    {
      "key": "channelId",
      "value": "",
      "type": "string",
      "description": "Channel ID (auto-saved after creating channel)"
    },
    {
      "key": "messageId",
      "value": "",
      "type": "string",
      "description": "Message ID (auto-saved after sending message)"
    },
    {
      "key": "conversationId",
      "value": "",
      "type": "string",
      "description": "Conversation ID (auto-saved after creating a direct chat)"
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    try {",
                  "        const responseJson = pm.response.json();",
                  "        if (responseJson.user && responseJson.user.id) {",
                  "            pm.collectionVariables.set('userId', responseJson.user.id);",
                  "            console.log('✅ User ID saved:', responseJson.user.id);",
                  "        }",
                  "    } catch (e) {",
                  "        console.log('Error parsing response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"Password123\",\n  \"fullName\": \"John Doe\",\n  \"role\": \"ADMIN\",\n  \"profilePhoto\": \"https://example.com/photo.jpg\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/create",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "create"]
            },
            "description": "Register a new user. User must verify OTP and wait for super admin approval.\n\n**Roles available:** ADMIN, OPERATIONS, FINANCE, DRIVER, STAFF\n\n**Note:** Static OTP is currently set to '1234'"
          },
          "response": []
        },
        {
          "name": "Verify OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('✅ OTP verified successfully. Account is now pending approval.');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"otp\": \"1234\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/verify-otp",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "verify-otp"]
            },
            "description": "Verify OTP after registration. After verification, account status changes to PENDING_APPROVAL and user must wait for super admin approval."
          },
          "response": []
        },
        {
          "name": "Resend OTP",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/resend-otp",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "resend-otp"]
            },
            "description": "Resend OTP to user's email"
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    try {",
                  "        const responseJson = pm.response.json();",
                  "        if (responseJson.data && responseJson.data.token) {",
                  "            pm.collectionVariables.set('token', responseJson.data.token);",
                  "            console.log('✅ Login token saved');",
                  "        } else if (responseJson.token) {",
                  "            pm.collectionVariables.set('token', responseJson.token);",
                  "            console.log('✅ Login token saved');",
                  "        }",
                  "        if (responseJson.user && responseJson.user._id) {",
                  "            pm.collectionVariables.set('userId', responseJson.user._id);",
                  "        } else if (responseJson.data && responseJson.data.user && responseJson.data.user._id) {",
                  "            pm.collectionVariables.set('userId', responseJson.data.user._id);",
                  "        }",
                  "    } catch (e) {",
                  "        console.log('Error parsing response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"Password123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "login"]
            },
            "description": "Login user. Returns JWT token if account is ACTIVE and approved."
          },
          "response": []
        },
        {
          "name": "Social Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    try {",
                  "        const responseJson = pm.response.json();",
                  "        if (responseJson.token) {",
                  "            pm.collectionVariables.set('token', responseJson.token);",
                  "        }",
                  "    } catch (e) {",
                  "        console.log('Error:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"provider\": \"GOOGLE\",\n  \"providerId\": \"google-oauth-sub-123\",\n  \"userName\": \"johndoe\",\n  \"profilePhoto\": \"https://example.com/avatar.jpg\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/social-login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "social-login"]
            },
            "description": "Social login (Google, Apple, Facebook)"
          },
          "response": []
        },
        {
          "name": "Get User by Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/user-by-token",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "user-by-token"]
            },
            "description": "Get current authenticated user information"
          },
          "response": []
        }
      ],
      "description": "Authentication endpoints for user registration, login, and OTP verification"
    },
    {
      "name": "Password Management",
      "item": [
        {
          "name": "Forgot Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/forgot-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "forgot-password"]
            },
            "description": "Send OTP to reset password (static OTP: 1234)"
          },
          "response": []
        },
        {
          "name": "Update Password (with OTP)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"newPassword\": \"NewPassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/update-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "update-password"]
            },
            "description": "Update password after receiving OTP"
          },
          "response": []
        },
        {
          "name": "Change Password (Authenticated)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"oldPassword\": \"OldPassword123\",\n  \"newPassword\": \"NewPassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "change-password"]
            },
            "description": "Change password for authenticated user"
          },
          "response": []
        }
      ],
      "description": "Password management endpoints"
    },
    {
      "name": "User Profile",
      "item": [
        {
          "name": "Get All Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/users?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Items per page"
                }
              ]
            },
            "description": "Get paginated list of all active users"
          },
          "response": []
        },
        {
          "name": "Get User by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/:id",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", ":id"],
              "variable": [
                {
                  "key": "id",
                  "value": "{{userId}}",
                  "description": "User ID"
                }
              ]
            },
            "description": "Get user details by ID"
          },
          "response": []
        },
        {
          "name": "Update Profile",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Updated Full Name\",\n  \"userName\": \"updated_username\",\n  \"profilePhoto\": \"https://example.com/new-photo.jpg\",\n  \"email\": \"newemail@example.com\",\n  \"password\": \"NewPassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/update-profile/:id",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "update-profile", ":id"],
              "variable": [
                {
                  "key": "id",
                  "value": "{{userId}}",
                  "description": "User ID (must match authenticated user)"
                }
              ]
            },
            "description": "Update user profile. User can only update their own profile."
          },
          "response": []
        },
        {
          "name": "Update User (Admin)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Updated Name\",\n  \"userName\": \"new_username\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/update-user/:id",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "update-user", ":id"],
              "variable": [
                {
                  "key": "id",
                  "value": "{{userId}}",
                  "description": "User ID"
                }
              ]
            },
            "description": "Admin endpoint to update any user"
          },
          "response": []
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/:id",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", ":id"],
              "variable": [
                {
                  "key": "id",
                  "value": "{{userId}}",
                  "description": "User ID to delete"
                }
              ]
            },
            "description": "Soft delete user (sets status to INACTIVE)"
          },
          "response": []
        }
      ],
      "description": "User profile management endpoints"
    },
    {
      "name": "Approval Management (Super Admin Only)",
      "item": [
        {
          "name": "Get Pending Approvals",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const responseJson = pm.response.json();",
                  "    console.log('Pending approvals:', responseJson.data?.length || 0);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/approvals/pending?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "approvals", "pending"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Items per page"
                }
              ]
            },
            "description": "Get list of users pending approval. **Super Admin only**"
          },
          "response": []
        },
        {
          "name": "Approve User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('✅ User approved successfully');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"assignedRole\": \"ADMIN\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/approvals/:userId/approve",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "approvals", ":userId", "approve"],
              "variable": [
                {
                  "key": "userId",
                  "value": "{{userId}}",
                  "description": "User ID to approve"
                }
              ]
            },
            "description": "Approve a pending user and assign role. **Super Admin only**\n\n**Available roles:** ADMIN, OPERATIONS, FINANCE, DRIVER, STAFF\n\n**Note:** Super admin can assign any role, regardless of what the user requested."
          },
          "response": []
        },
        {
          "name": "Reject User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('✅ User rejected');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{superAdminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rejectionReason\": \"Does not meet requirements\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/approvals/:userId/reject",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "approvals", ":userId", "reject"],
              "variable": [
                {
                  "key": "userId",
                  "value": "{{userId}}",
                  "description": "User ID to reject"
                }
              ]
            },
            "description": "Reject a pending user application. **Super Admin only**"
          },
          "response": []
        }
      ],
      "description": "Approval management endpoints for super admin. These endpoints require SUPER_ADMIN role."
    },
    {
      "name": "File Upload",
      "item": [
        {
          "name": "Upload Image (Base64)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"imageBase64\": \"data:image/jpeg;base64,/9j/4AAQSkZJRg...\",\n  \"contentType\": \"image/jpeg\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/upload-image",
              "host": ["{{baseUrl}}"],
              "path": ["upload-image"]
            },
            "description": "Upload image using base64 encoding"
          },
          "response": []
        },
        {
          "name": "Upload Image (Multer)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": []
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/upload-image-multer",
              "host": ["{{baseUrl}}"],
              "path": ["upload-image-multer"]
            },
            "description": "Upload image using multipart form data"
          },
          "response": []
        },
        {
          "name": "Upload Audio (Multer)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "audio",
                  "type": "file",
                  "src": []
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/upload-audio-multer",
              "host": ["{{baseUrl}}"],
              "path": ["upload-audio-multer"]
            },
            "description": "Upload audio file (MP3, WAV)"
          },
          "response": []
        },
        {
          "name": "Upload Media (Base64)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"file\": \"data:audio/mpeg;base64,SUQzBAAAAAA...\",\n  \"mediaType\": \"audio\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/upload-media",
              "host": ["{{baseUrl}}"],
              "path": ["upload-media"]
            },
            "description": "Upload media file (audio/video) using base64"
          },
          "response": []
        },
        {
          "name": "Upload File (Base64)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fileBase64\": \"data:application/pdf;base64,JVBERi0xLjQ...\",\n  \"contentType\": \"application/pdf\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/upload-file",
              "host": ["{{baseUrl}}"],
              "path": ["upload-file"]
            },
            "description": "Upload any file using base64 encoding"
          },
          "response": []
        },
        {
          "name": "Upload Image (Any Format) - Server",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": [],
                  "description": "Any image format (JPG, PNG, GIF, WEBP, SVG, etc.)"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/upload/image",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "upload", "image"]
            },
            "description": "Upload any image format. Files are saved to server in uploads/images/ directory.\n\n**Supported formats:** JPG, JPEG, PNG, GIF, WEBP, SVG, BMP, TIFF, and any other image format\n\n**Max file size:** 5MB\n\n**Field name:** image"
          },
          "response": []
        },
        {
          "name": "Upload Document (PDF, DOCX, etc.) - Server",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "document",
                  "type": "file",
                  "src": [],
                  "description": "PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, CSV"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/upload/document",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "upload", "document"]
            },
            "description": "Upload document files. Files are saved to server in uploads/documents/ directory.\n\n**Supported formats:**\n- PDF (.pdf)\n- Word (.doc, .docx)\n- Excel (.xls, .xlsx)\n- PowerPoint (.ppt, .pptx)\n- Text (.txt)\n- CSV (.csv)\n\n**Max file size:** 10MB\n\n**Field name:** document"
          },
          "response": []
        }
      ],
      "description": "File upload endpoints"
    },
    {
      "name": "Messaging",
      "item": [
        {
          "name": "Channels",
          "item": [
            {
              "name": "Create Channel",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    try {",
                      "        const responseJson = pm.response.json();",
                      "        if (responseJson.data && responseJson.data._id) {",
                      "            pm.collectionVariables.set('channelId', responseJson.data._id);",
                      "            console.log('✅ Channel ID saved:', responseJson.data._id);",
                      "        }",
                      "    } catch (e) {",
                      "        console.log('Error parsing response:', e);",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"name\": \"allocations\",\n  \"description\": \"Channel for allocation discussions\",\n  \"members\": [],\n  \"isPrivate\": false\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels"]
                },
                "description": "Create a new channel. Only the creator can send messages in the channel.\n\n**Note:** Members array should contain user IDs. Empty array means only creator is in the channel."
              },
              "response": []
            },
            {
              "name": "Get All Channels",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels?search=&starred=false",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels"],
                  "query": [
                    {
                      "key": "search",
                      "value": "",
                      "description": "Search channels by name"
                    },
                    {
                      "key": "starred",
                      "value": "false",
                      "description": "Filter by starred status (true/false)"
                    }
                  ]
                },
                "description": "Get all channels the authenticated user is a member of or created.\n\n**Query Parameters:**\n- `search` - Search channels by name (optional)\n- `starred` - Filter by starred status: true/false (optional)"
              },
              "response": []
            },
            {
              "name": "Get Channel by ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}"]
                },
                "description": "Get details of a specific channel. User must be a member or creator."
              },
              "response": []
            },
            {
              "name": "Update Channel",
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"name\": \"updated-channel-name\",\n  \"description\": \"Updated description\",\n  \"isPrivate\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}"]
                },
                "description": "Update channel details. Only the creator can update the channel.\n\n**Updatable fields:**\n- `name` - Channel name\n- `description` - Channel description\n- `isPrivate` - Privacy setting\n- `members` - Array of member user IDs"
              },
              "response": []
            },
            {
              "name": "Delete Channel",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}"]
                },
                "description": "Delete a channel. Only the creator can delete. This will also delete all messages in the channel."
              },
              "response": []
            },
            {
              "name": "Add Members to Channel",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"memberIds\": [\"507f1f77bcf86cd799439011\", \"507f191e810c19729de860ea\"]\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}/members",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}", "members"]
                },
                "description": "Add members to a channel. Only the creator can add members.\n\n**Note:** Replace the user IDs in `memberIds` array with actual user IDs from your system."
              },
              "response": []
            },
            {
              "name": "Remove Members from Channel",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"memberIds\": [\"507f1f77bcf86cd799439011\"]\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}/members",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}", "members"]
                },
                "description": "Remove members from a channel. Only the creator can remove members."
              },
              "response": []
            },
            {
              "name": "Toggle Star Channel",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}/star",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}", "star"]
                },
                "description": "Toggle star status of a channel. Any member can star/unstar a channel."
              },
              "response": []
            }
          ],
          "description": "Channel management endpoints"
        },
        {
          "name": "Conversations",
          "item": [
            {
              "name": "Start or Get Conversation",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201 || pm.response.code === 200) {",
                      "    try {",
                      "        const responseJson = pm.response.json();",
                      "        if (responseJson.data && responseJson.data._id) {",
                      "            pm.collectionVariables.set('conversationId', responseJson.data._id);",
                      "            console.log('✅ Conversation ID saved:', responseJson.data._id);",
                      "        }",
                      "    } catch (e) {",
                      "        console.log('Error parsing response:', e);",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"recipientId\": \"507f1f77bcf86cd799439011\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/conversations",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "messages",
                    "conversations"
                  ]
                },
                "description": "Creates a one-on-one conversation with the specified recipient. If a conversation already exists, it returns the existing one."
              },
              "response": []
            },
            {
              "name": "List Conversations",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/conversations?search=&includeArchived=false",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "messages",
                    "conversations"
                  ],
                  "query": [
                    {
                      "key": "search",
                      "value": "",
                      "description": "Search by participant name, username, or email"
                    },
                    {
                      "key": "includeArchived",
                      "value": "false",
                      "description": "Set true to include archived conversations"
                    }
                  ]
                },
                "description": "Returns all direct conversations the authenticated user participates in, ordered by last activity."
              },
              "response": []
            },
            {
              "name": "Get Conversation",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/conversations/{{conversationId}}",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "messages",
                    "conversations",
                    "{{conversationId}}"
                  ]
                },
                "description": "Retrieve details for a single conversation (participants, last message, timestamps)."
              },
              "response": []
            },
            {
              "name": "Send Conversation Message",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    try {",
                      "        const responseJson = pm.response.json();",
                      "        if (responseJson.data && responseJson.data._id) {",
                      "            pm.collectionVariables.set('messageId', responseJson.data._id);",
                      "            console.log('✅ Message ID saved:', responseJson.data._id);",
                      "        }",
                      "    } catch (e) {",
                      "        console.log('Error parsing response:', e);",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"Hey, can you review the latest job assignment?\",\n  \"messageType\": \"text\",\n  \"attachments\": []\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/conversations/{{conversationId}}/messages",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "messages",
                    "conversations",
                    "{{conversationId}}",
                    "messages"
                  ]
                },
                "description": "Send a direct message within the specified conversation. Both participants can send messages."
              },
              "response": []
            },
            {
              "name": "Get Conversation Messages",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/conversations/{{conversationId}}/messages?page=1&limit=50",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "messages",
                    "conversations",
                    "{{conversationId}}",
                    "messages"
                  ],
                  "query": [
                    {
                      "key": "page",
                      "value": "1",
                      "description": "Page number (default 1)"
                    },
                    {
                      "key": "limit",
                      "value": "50",
                      "description": "Messages per page (default 50)"
                    }
                  ]
                },
                "description": "Retrieve paginated direct messages for the specified conversation. Messages are returned oldest first."
              },
              "response": []
            }
          ],
          "description": "One-on-one direct conversation APIs. Conversations are unique per participant pair—if one already exists, it is returned instead of creating a duplicate."
        },
        {
          "name": "Messages",
          "item": [
            {
              "name": "Send Message",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    try {",
                      "        const responseJson = pm.response.json();",
                      "        if (responseJson.data && responseJson.data._id) {",
                      "            pm.collectionVariables.set('messageId', responseJson.data._id);",
                      "            console.log('✅ Message ID saved:', responseJson.data._id);",
                      "        }",
                      "    } catch (e) {",
                      "        console.log('Error parsing response:', e);",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"Hello everyone! This is a test message.\",\n  \"messageType\": \"text\",\n  \"attachments\": []\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}/messages",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}", "messages"]
                },
                "description": "Send a message to a channel. **Only the channel creator can send messages.**\n\n**Message Types:**\n- `text` - Plain text message (default)\n- `image` - Image message\n- `file` - File attachment\n- `audio` - Audio message\n- `video` - Video message\n\n**Attachments format:**\n```json\n[\n  {\n    \"url\": \"https://example.com/file.jpg\",\n    \"fileName\": \"image.jpg\",\n    \"fileType\": \"image/jpeg\",\n    \"fileSize\": 1024000\n  }\n]\n```"
              },
              "response": []
            },
            {
              "name": "Get Messages",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/channels/{{channelId}}/messages?page=1&limit=50",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "channels", "{{channelId}}", "messages"],
                  "query": [
                    {
                      "key": "page",
                      "value": "1",
                      "description": "Page number (default: 1)"
                    },
                    {
                      "key": "limit",
                      "value": "50",
                      "description": "Number of messages per page (default: 50)"
                    }
                  ]
                },
                "description": "Get messages from a channel. User must be a member or creator.\n\n**Query Parameters:**\n- `page` - Page number (default: 1)\n- `limit` - Messages per page (default: 50)\n\n**Note:** Messages are returned in chronological order (oldest first)."
              },
              "response": []
            },
            {
              "name": "Update Message",
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"Updated message content\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/messages/{{messageId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "messages", "{{messageId}}"]
                },
                "description": "Update a message. Only the message sender can update their own messages."
              },
              "response": []
            },
            {
              "name": "Delete Message",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/messages/{{messageId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "messages", "{{messageId}}"]
                },
                "description": "Delete a message (soft delete). Only the message sender can delete their own messages."
              },
              "response": []
            }
          ],
          "description": "Message management endpoints. **Important:** Only channel creators can send messages."
        },
        {
          "name": "Direct Messages",
          "item": [
            {
              "name": "Get Direct Messages",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}",
                    "type": "text"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/messages/direct-messages/{{userId}}?page=1&limit=50",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "messages", "direct-messages", "{{userId}}"],
                  "query": [
                    {
                      "key": "page",
                      "value": "1",
                      "description": "Page number (default: 1)"
                    },
                    {
                      "key": "limit",
                      "value": "50",
                      "description": "Number of messages per page (default: 50)"
                    }
                  ]
                },
                "description": "Get direct messages between the authenticated user and another user.\n\n**Note:** Replace `{{userId}}` with the ID of the user you want to message with. A direct message channel will be created automatically if it doesn't exist."
              },
              "response": []
            }
          ],
          "description": "Direct messaging endpoints for one-on-one conversations"
        }
      ],
      "description": "Messaging system with channels and direct conversations. **Channel rule:** Only channel creators can send messages; members have read-only access. **Conversation rule:** Both participants can send/receive.\n\n**Socket.IO Events:**\n- Connect with JWT token in `auth.token` or `Authorization` header\n- `joinChannel` / `leaveChannel`\n- `joinConversation` / `leaveConversation`\n- `sendMessage` (channel) / `sendConversationMessage` (direct)\n- `typing` / `stopTyping` with `channelId` or `conversationId`\n- `updateMessage` / `deleteMessage`\n\n**Listen for:**\n- `newMessage` (channel)\n- `conversation:newMessage`\n- `messageUpdated` & `conversation:messageUpdated`\n- `messageDeleted` & `conversation:messageDeleted`\n- `channelUpdate` / `conversation:update`\n- `userTyping` / `userStopTyping`\n- `conversation:userTyping` / `conversation:userStopTyping`"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "console.log('📋 API Request:', pm.request.method, pm.request.url);",
          "console.log('🔑 Token:', pm.collectionVariables.get('token') ? '✅ Set' : '❌ Not set');"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "if (pm.response.code === 200 || pm.response.code === 201) {",
          "    console.log('✅ Request successful');",
          "} else if (pm.response.code === 401) {",
          "    console.log('❌ Authentication failed - check your token');",
          "} else if (pm.response.code === 403) {",
          "    console.log('❌ Permission denied - check your role');",
          "} else {",
          "    console.log('⚠️ Request failed:', pm.response.code);",
          "}"
        ]
      }
    }
  ]
}

